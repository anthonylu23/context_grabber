#!/bin/bash
# postinstall â€” runs after the CLI component is installed.
# Note: installer scripts run as root, so $HOME is /var/root.
# Resolve the real user's home directory instead.

REAL_USER="${USER:-$(stat -f '%Su' /dev/console)}"
REAL_HOME=$(dscl . -read "/Users/$REAL_USER" NFSHomeDirectory 2>/dev/null | awk '{print $2}')

if [[ -z "$REAL_HOME" ]]; then
  # Fallback: skip directory creation rather than writing to /var/root
  exit 0
fi

mkdir -p "$REAL_HOME/contextgrabber"
chown "$REAL_USER" "$REAL_HOME/contextgrabber"

exit 0
